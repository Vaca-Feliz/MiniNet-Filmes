let movies = JSON.parse(localStorage.getItem("movies")) || [];

const movieList = document.getElementById("movieList");
const addMovieBtn = document.getElementById("addMovieBtn");
const searchBar = document.getElementById("searchBar");

const modal = document.getElementById("editModal");
const closeBtn = document.getElementById("closeModalBtn");
const saveBtn = document.getElementById("saveMovieBtn");

const titleInput = document.getElementById("movieTitleInput");
const ageInput = document.getElementById("movieAgeInput");
const ratingInput = document.getElementById("movieRatingInput");
const imageInput = document.getElementById("movieImageInput");

let editingIndex = -1;

// Mostrar filmes
function renderMovies() {
    movieList.innerHTML = "";

    const search = searchBar.value.toLowerCase();

    movies
        .filter(m => m.title.toLowerCase().includes(search))
        .forEach((movie, index) => {
            const card = document.createElement("div");
            card.className = "movie-card";

            card.innerHTML = `
                <img src="${movie.image}" alt="Imagem do filme" />
                <h3>${movie.title}</h3>
                <p>Idade mínima: ${movie.age}</p>
                <p>Avaliação: ${movie.rating}/10</p>

                <button class="edit-btn" onclick="editMovie(${index})">Editar</button>
                <button class="delete-btn" onclick="deleteMovie(${index})">Remover</button>
            `;

            movieList.appendChild(card);
        });
}

renderMovies();

// Abrir modal para adicionar
addMovieBtn.onclick = () => {
    editingIndex = -1;
    titleInput.value = "";
    ageInput.value = "";
    ratingInput.value = "";
    imageInput.value = "";
    modal.style.display = "flex";
};

// Editar filme
function editMovie(index) {
    editingIndex = index;

    const movie = movies[index];

    titleInput.value = movie.title;
    ageInput.value = movie.age;
    ratingInput.value = movie.rating;
    imageInput.value = "";

    modal.style.display = "flex";
}

// Guardar filme
saveBtn.onclick = () => {
    let imgData = movies[editingIndex]?.image || "";

    if (imageInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = () => {
            imgData = reader.result;
            saveData(imgData);
        };
        reader.readAsDataURL(imageInput.files[0]);
    } else {
        saveData(imgData);
    }
};

// Função que grava os dados
function saveData(imgData) {
    const movieData = {
        title: titleInput.value,
        age: ageInput.value,
        rating: ratingInput.value,
        image: imgData
    };

    if (editingIndex === -1) {
        movies.push(movieData);
    } else {
        movies[editingIndex] = movieData;
    }

    localStorage.setItem("movies", JSON.stringify(movies));

    modal.style.display = "none";
    renderMovies();
}

// Remover
function deleteMovie(index) {
    movies.splice(index, 1);
    localStorage.setItem("movies", JSON.stringify(movies));
    renderMovies();
}

closeBtn.onclick = () => {
    modal.style.display = "none";
};




